#+TITLE: numhask-bench

Performance testing of [[https://hackage.haskell.org/package/numhask-array][numhask-array]] using [[https://hackage.haskell.org/package/perf][perf]].

To install the benchmark locally:

#+begin_src sh
cabal build && cabal install
#+end_src

#+begin_src sh
numhask-bench -r 100 -m 10 -xdv --best
#+end_src

#+RESULTS:
| mmult           |              10x10 |
| hmatrix         |              919.8 |
| numhask-hmatrix |              924.5 |
| Fixed           |             1501.0 |
| Dynamic         |             1304.0 |
| Fixed-dotsum    | 3088.9345661450925 |
| Vector-dot      |             2737.0 |
| Fixed-dot       |  98.45454545454545 |
| Dynamic-dot     | 130326.39611060794 |

* ToDo runtime control

https://downloads.haskell.org/~ghc/9.0.1/docs/html/users_guide/runtime_control.html

#+begin_src sh
numhask-bench +RTS -A128m -N2 -qn2 -Fd4 -xn
#+end_src

* ghci

#+begin_src haskell :results output
:set prompt " > "
:set -Wno-type-defaults
:set -Wno-name-shadowing
:set -XOverloadedStrings
putStrLn "ok"
#+end_src

#+RESULTS:
#+begin_example
Build profile: -w ghc-8.10.7 -O1
In order, the following will be built (use -v for more details):
 - perf-0.10.0 (lib) (file src/Perf/Types.hs changed)
 - numhask-bench-0.0.2 (exe:numhask-bench) (dependency rebuilt)
Preprocessing library for perf-0.10.0..
Building library for perf-0.10.0..
[3 of 8] Compiling Perf.Types       ( src/Perf/Types.hs, /Users/tonyday/haskell/numhask-bench/dist-newstyle/build/x86_64-osx/ghc-8.10.7/perf-0.10.0/build/Perf/Types.o, /Users/tonyday/haskell/numhask-bench/dist-newstyle/build/x86_64-osx/ghc-8.10.7/perf-0.10.0/build/Perf/Types.dyn_o )
Preprocessing executable 'numhask-bench' for numhask-bench-0.0.2..
GHCi, version 8.10.7: https://www.haskell.org/ghc/  :? for help
Loaded GHCi configuration from /Users/tonyday/haskell/numhask-bench/.ghci
[1 of 1] Compiling Main             ( bench.hs, interpreted )
Ok, one module loaded.
,*Main>  >  >  >  > ok
#+end_example

#+begin_src haskell :results output
:load bench.hs
putStrLn "ok"
#+end_src

#+RESULTS:
: [1 of 1] Compiling Main             ( bench.hs, interpreted )
: Ok, one module loaded.
: ok

#+begin_src haskell
:main -r 100 -m 10 -xdv --best
#+end_src

#+RESULTS:
: mmult 10x10
: hmatrix 1153.0
: numhask-hmatrix 1201.0
: Fixed 2628.0
: Dynamic 1578.4796049806785
: Fixed-dotsum 3304.5
: Vector-dot 18698.0
: Fixed-dot 110.3125
: Dynamic-dot 140152.0

* new bench

#+begin_src sh
numhask-bench-new --runs 10000 -m 10
#+end_src

#+RESULTS:
|   | label1          | label2 | results |
|   | ---             | ---    |     --- |
|   | dynamic         | time   | 14100.0 |
|   | fixed           | time   | 28000.0 |
|   | hmatrix         | time   |  2380.0 |
|   | numhask-hmatrix | time   |  2490.0 |

#+begin_src sh
numhask-bench-old --runs 10000 -m 10
#+end_src

#+RESULTS:
| hmatrix         |   2173.507 |
| numhask-hmatrix |  1941.2094 |
| Fixed           |  22813.468 |
| Dynamic         | 25433.8702 |
